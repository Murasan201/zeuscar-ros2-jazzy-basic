# セットアップガイド - ホストPC

## 概要
本ドキュメントは、ZeusCar ROS2プロジェクトのホストPC（操作側）の環境構築手順を記載する。
ホストPCはROS2 Publisherノードを実行し、Raspberry Pi側にコマンドを送信する役割を担う。

## システム構成

```
[Host PC]          -- ROS2 topic -->  [Raspberry Pi]      -- Serial -->  [Arduino]
Publisher                              Subscriber                         Motor Controller
(本ガイドの対象)                        (setup-guide.md)                   (メカナムホイール)
```

## 対象環境

| 項目 | 内容 |
|------|------|
| PC | デスクトップPC / ノートPC |
| ストレージ | SSD（内蔵または外付け） |
| OS | Ubuntu 24.04 LTS (Noble Numbat) |
| ROS2 | Jazzy Jalisco |

---

## 1. インストールの準備

### 1.1 必要なもの

| 項目 | 説明 |
|------|------|
| インストール対象PC | SSDを搭載したPC |
| USBメモリ | 8GB以上（インストールメディア用） |
| 別のPC | インストールUSBを作成するため |
| インターネット接続 | 有線LAN推奨（インストール中のアップデート用） |

### 1.2 Ubuntu ISOイメージのダウンロード

Ubuntu公式サイトからデスクトップ版のISOイメージをダウンロードする。

- URL: https://ubuntu.com/download/desktop
- ファイル: `ubuntu-24.04.x-desktop-amd64.iso`（約5GB）

> **Note**: サーバー版ではなく**デスクトップ版**を選択する。
> RViz2等のGUIツールを使用するため、デスクトップ環境が必要。

### 1.3 インストールUSBの作成

#### Windows環境の場合（Rufus使用）

1. Rufusをダウンロード: https://rufus.ie/
2. Rufusを起動
3. 設定:
   - デバイス: USBメモリを選択
   - ブートの種類: ダウンロードしたISOファイルを選択
   - パーティション構成: GPT
   - ターゲットシステム: UEFI（非CSM）
   - ファイルシステム: FAT32（Large）
4. 「スタート」をクリックしてUSBを作成

#### Linux環境の場合

```bash
# USBメモリのデバイス名を確認（例: /dev/sdb）
lsblk

# ISOイメージをUSBに書き込み（sdXは実際のデバイス名に置き換え）
sudo dd if=ubuntu-24.04-desktop-amd64.iso of=/dev/sdX bs=4M status=progress
sudo sync
```

> **Warning**: `dd`コマンドは指定したデバイスを完全に上書きする。
> デバイス名を間違えると他のディスクのデータが消失するので注意。

#### macOS環境の場合（balenaEtcher使用）

1. balenaEtcherをダウンロード: https://www.balena.io/etcher/
2. アプリを起動
3. 「Flash from file」でISOファイルを選択
4. 「Select target」でUSBメモリを選択
5. 「Flash!」をクリック

---

## 2. BIOS/UEFI設定

### 2.1 BIOS設定画面への入り方

PCの電源を入れた直後に、メーカーに応じたキーを押してBIOS設定画面に入る。

| メーカー | キー |
|---------|------|
| Dell | F2 または F12 |
| HP | F10 または Esc |
| Lenovo | F1 または F2 |
| ASUS | F2 または Del |
| Acer | F2 または Del |
| 自作PC | Del または F2 |

### 2.2 セキュアブートの無効化

Ubuntuのインストールにはセキュアブートを無効にすることを推奨。

1. BIOS設定画面で「Security」または「Boot」タブを探す
2. 「Secure Boot」を「Disabled」に変更
3. 設定を保存して終了

> **Note**: 一部のPCではセキュアブート有効のままでもインストール可能だが、
> ドライバの問題が発生する場合があるため、無効化を推奨。

### 2.3 ブート順序の変更

USBメモリからブートするために、ブート順序を変更する。

1. 「Boot」タブを開く
2. ブート順序（Boot Priority / Boot Order）を変更
3. USBデバイスを最優先に設定
4. 設定を保存して終了（通常はF10キー）

> **Note**: 一部のPCでは、起動時にF12等を押すことでブートデバイスを
> 一時的に選択できる（ブートメニュー）。

---

## 3. Ubuntuのインストール

### 3.1 インストーラーの起動

1. インストールUSBを挿入してPCを起動
2. ブートメニューが表示されたら「Try or Install Ubuntu」を選択
3. Ubuntuのライブ環境が起動する

### 3.2 インストールの開始

1. デスクトップの「Install Ubuntu」アイコンをダブルクリック
2. または自動的にインストーラーが起動する

### 3.3 言語の選択

1. 左側のリストから「日本語」を選択
2. 「次へ」をクリック

### 3.4 キーボードレイアウトの選択

1. 「Japanese」を選択
2. レイアウトは「Japanese」または使用するキーボードに合わせて選択
3. 「次へ」をクリック

### 3.5 インストールの種類

1. 「通常のインストール」を選択
   - Webブラウザ、ユーティリティ、オフィスソフトなどが含まれる
2. オプション:
   - [x] Ubuntuのインストール中にアップデートをダウンロードする
   - [x] グラフィックスとWi-Fiハードウェアと追加のメディアフォーマットのサードパーティ製ソフトウェアをインストールする
3. 「次へ」をクリック

### 3.6 インストール先の選択

#### SSD全体を使用する場合（推奨）

1. 「ディスクを削除してUbuntuをインストール」を選択
2. インストール先のSSDを選択
3. 「次へ」をクリック

> **Warning**: この操作でSSD上の全データが削除される。
> 必要なデータは事前にバックアップすること。

#### デュアルブートの場合（Windowsと共存）

1. 「Ubuntuを○○と併用してインストール」を選択
2. スライダーでパーティションサイズを調整
3. Ubuntuには最低50GB以上を割り当てることを推奨
4. 「次へ」をクリック

#### 手動パーティション設定の場合（上級者向け）

1. 「その他」を選択
2. パーティションテーブルを作成（必要な場合）
3. 以下のパーティションを作成:
   - EFIシステムパーティション: 512MB（/boot/efi、FAT32）
   - ルートパーティション: 残り全て（/、ext4）
   - スワップ: RAMの1〜2倍（オプション）

### 3.7 タイムゾーンの設定

1. 地図上で「Tokyo」を選択、または「Asia/Tokyo」を入力
2. 「次へ」をクリック

### 3.8 ユーザー情報の設定

以下の情報を入力:

| 項目 | 説明 | 例 |
|------|------|-----|
| あなたの名前 | フルネーム（表示名） | Your Name |
| コンピューターの名前 | ホスト名 | zeuscar-host |
| ユーザー名 | ログインID | user |
| パスワード | ログインパスワード | （強力なパスワードを設定） |

オプション:
- [ ] 自動的にログインする（セキュリティ上、推奨しない）

「次へ」をクリック

### 3.9 インストールの実行

1. 設定内容を確認
2. 「インストール」をクリック
3. インストールが完了するまで待機（10〜30分程度）

### 3.10 インストール完了

1. 「今すぐ再起動する」をクリック
2. 「Please remove the installation medium, then press ENTER」と表示されたら、USBメモリを抜いてEnterキーを押す

---

## 4. 初回起動と初期設定

### 4.1 初回起動

1. PCが再起動し、GRUBブートローダーが表示される
2. 「Ubuntu」を選択（または自動的に起動）
3. ログイン画面が表示されたら、設定したパスワードでログイン

### 4.2 初期設定ウィザード

初回ログイン時に設定ウィザードが表示される場合がある:

1. オンラインアカウント: スキップ可能
2. Livepatch: スキップ可能（Ubuntuアカウントが必要）
3. ヘルプの改善: 任意
4. プライバシー: 任意
5. 「完了」をクリック

### 4.3 システムアップデート

ターミナルを開いて（Ctrl+Alt+T）、システムを最新の状態に更新する。

```bash
# パッケージリストの更新
sudo apt-get update

# パッケージのアップグレード
sudo apt-get upgrade -y

# 再起動（カーネルが更新された場合）
sudo reboot
```

### 4.4 インストール確認

```bash
# OS情報の確認
cat /etc/os-release

# 期待される出力
# PRETTY_NAME="Ubuntu 24.04 LTS"
# VERSION="24.04 LTS (Noble Numbat)"
```

```bash
# カーネル情報の確認
uname -a

# 期待される出力例
# Linux zeuscar-host 6.8.0-xx-generic ... x86_64 GNU/Linux
```

```bash
# ディスク情報の確認（SSDが認識されているか）
lsblk

# 期待される出力例
# NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
# sda      8:0    0 500.0G  0 disk
# ├─sda1   8:1    0   512M  0 part /boot/efi
# └─sda2   8:2    0 499.5G  0 part /
```

---

## 5. 追加設定（任意）

### 5.1 日本語入力の設定

```bash
# Fcitx5とMozcのインストール
sudo apt-get install -y fcitx5-mozc

# 入力メソッドの設定
im-config -n fcitx5
```

再起動後、システム設定から入力メソッドを設定。

### 5.2 SSHサーバーのインストール

リモートからアクセスする場合:

```bash
# OpenSSHサーバーのインストール
sudo apt-get install -y openssh-server

# SSHサービスの状態確認
sudo systemctl status ssh

# ファイアウォールでSSHを許可
sudo ufw allow ssh
```

### 5.3 固定IPアドレスの設定（任意）

ROS2のネットワーク通信を安定させるために、固定IPを設定することを推奨。

1. 「設定」→「ネットワーク」を開く
2. 接続中のネットワークの歯車アイコンをクリック
3. 「IPv4」タブを選択
4. 「手動」を選択し、以下を設定:
   - アドレス: 192.168.x.x（ネットワーク環境に合わせる）
   - ネットマスク: 255.255.255.0
   - ゲートウェイ: 192.168.x.1
   - DNS: 8.8.8.8, 8.8.4.4
5. 「適用」をクリック

---

## 次のステップ

Ubuntuのインストールが完了したら、以下のセットアップに進む:

1. **開発環境のセットアップ** - Git, Python, C++等
2. **ROS2 Jazzyのインストール** - セットアップガイド（setup-guide.md）のセクション2を参照
3. **Publisherパッケージの作成** - PC側の制御ノード

> **Note**: ROS2のインストール手順はRaspberry Pi用セットアップガイド（setup-guide.md）の
> セクション2「ROS2 Jazzyのインストール」とほぼ同じ手順で実行できる。
> ただし、アーキテクチャがamd64である点のみ異なる。

---

## トラブルシューティング

### USBからブートできない

- BIOS設定でセキュアブートが無効になっているか確認
- ブート順序でUSBが最優先になっているか確認
- USBメモリが正しく作成されているか確認（別のツールで再作成を試す）

### インストール中にフリーズする

- グラフィックドライバの問題の可能性
- GRUBメニューで「e」キーを押し、`quiet splash`を`nomodeset`に変更して起動を試す

### SSDが認識されない

- BIOS設定でSATAモードがAHCIになっているか確認
- SSDが正しく接続されているか確認

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2026-01-29 | 初版作成（SSDへのUbuntuインストール手順） |
